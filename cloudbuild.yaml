substitutions:
  _PROJECT_ID: chatverse-475212
  _REGION: asia-south1
  _REPO: chatverse-docker-repo   # your Artifact Registry repo name

steps:
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', '${_REGION}-docker.pkg.dev/${_PROJECT_ID}/${_REPO}/client:latest', '-f', './client/Dockerfile', './client']

  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', '${_REGION}-docker.pkg.dev/${_PROJECT_ID}/${_REPO}/server:latest', '-f', './server/Dockerfile', './server']

  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', '${_REGION}-docker.pkg.dev/${_PROJECT_ID}/${_REPO}/client:latest']

  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', '${_REGION}-docker.pkg.dev/${_PROJECT_ID}/${_REPO}/server:latest']

images:
  - '${_REGION}-docker.pkg.dev/${_PROJECT_ID}/${_REPO}/client:latest'
  - '${_REGION}-docker.pkg.dev/${_PROJECT_ID}/${_REPO}/server:latest'

serviceAccount: github-cicd@chatverse-475212.iam.gserviceaccount.com

